(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[536],{5168:(e,t,n)=>{Promise.resolve().then(n.bind(n,7174))},5500:(e,t,n)=>{"use strict";var s=n(8188);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},7174:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var s=n(7406),a=n(6638),o=n(599),l=n(5500),r=n(5400);let c=()=>{let{t:e}=(0,o.Bd)("common"),t=(0,l.useRouter)(),[n,c]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),p=e=>"object"==typeof e&&null!==e&&"message"in e,m=(0,a.useCallback)(async()=>{let e=localStorage.getItem("vpn_user_token");if(!e)return void t.push("/login");h(!0);try{let n=r.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",s=await fetch("".concat(n,"/api/user/status"),{headers:{"x-access-token":e}});if(!s.ok){if(401===s.status){localStorage.removeItem("vpn_user_token"),t.push("/login");return}let e=await s.json();throw Error(e.message||"Failed to fetch user data")}let a=await s.json();c(a),d(null)}catch(e){d(p(e)?e.message:"An unexpected error occurred"),c(null)}finally{h(!1)}},[t]);(0,a.useEffect)(()=>{let e=()=>{let e=new URLSearchParams(window.location.search);"true"===e.get("payment_success")&&(alert("Payment successful! Your VIP plan is now active..."),t.replace("/dashboard")),"true"===e.get("payment_cancelled")&&(alert("Payment was cancelled. Your plan has not been changed."),t.replace("/dashboard"))};(async()=>{await m(),e()})()},[t,m]);let g=async()=>{let e=localStorage.getItem("vpn_user_token");if(!e){d("Authentication token not found. Please log in again."),t.push("/login");return}try{let t=r.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",s=await fetch("".concat(t,"/api/user/config"),{method:"GET",headers:{"x-access-token":e}});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to download configuration.")}let a=await s.blob(),o=window.URL.createObjectURL(a),l=document.createElement("a");l.href=o;let c=s.headers.get("content-disposition"),i="wg_config.conf";if(c){var n;let e=c.match(RegExp("filename=([\"']?)(?<filename>.+)\\1"));i=(null==e||null==(n=e.groups)?void 0:n.filename)||i}l.download=i,document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(o),d(null)}catch(e){d(p(e)?e.message:"An error occurred while downloading the configuration.")}},x=async()=>{let e=localStorage.getItem("vpn_user_token");if(!e)return void t.push("/login");d(null);try{let t=r.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",n=await fetch("".concat(t,"/api/payment/create-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json","x-access-token":e}}),s=await n.json();if(!n.ok)return void d(s.error||"Failed to create payment session.");s.checkout_url?window.location.href=s.checkout_url:d("Could not retrieve Stripe Checkout URL.")}catch(e){d(p(e)?e.message:"An error occurred during the upgrade process.")}};return u?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 text-center",children:e("loading")}):i&&!n?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 text-center text-red-500",children:[e("error"),": ",i,(0,s.jsx)("button",{onClick:()=>t.push("/login"),className:"text-blue-500 underline ml-2",children:e("go_to_login")})]}):n?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("header",{className:"mb-8",children:(0,s.jsx)("h1",{className:"text-3xl font-bold",children:e("nav_dashboard")})}),i&&(0,s.jsx)("p",{className:"text-red-500 text-center mb-4",children:i}),(0,s.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-lg mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:e("account_info")}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("email"),":"]})," ",n.email]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("current_plan"),":"]})," ",n.plan]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("status"),":"]})," ",(0,s.jsx)("span",{className:"font-semibold ".concat("Active"===n.status?"text-green-600":"text-red-600"),children:n.status})]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("subscription_expires"),":"]})," ",n.expires_at?new Date(n.expires_at).toLocaleDateString():e(n.is_vip?"na_vip":"na")]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("bandwidth_used"),":"]})," ",n.bandwidthUsed]}),(0,s.jsxs)("p",{children:[(0,s.jsxs)("strong",{children:[e("bandwidth_limit"),":"]})," ",n.bandwidthLimit]})]})]}),(0,s.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:e("actions")}),(0,s.jsxs)("div",{className:"space-y-4 md:space-y-0 md:space-x-4 md:flex items-center",children:[(0,s.jsx)("button",{onClick:g,className:"w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg",children:e("download_config")}),!n.is_vip&&(0,s.jsx)("button",{onClick:x,className:"w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg",children:e("upgrade_vip")}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("vpn_user_token"),t.push("/login")},className:"w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg",children:e("logout")})]})]})]}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 text-center",children:e("no_user_data")})}}},e=>{var t=t=>e(e.s=t);e.O(0,[599,379,353,358],()=>t(5168)),_N_E=e.O()}]);