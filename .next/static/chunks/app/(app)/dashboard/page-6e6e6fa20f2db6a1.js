(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[536],{108:(e,t,n)=>{Promise.resolve().then(n.bind(n,1259))},2411:(e,t,n)=>{"use strict";var s=n(6899);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},1259:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var s=n(9437),a=n(6546),o=n(9994),r=n(2411),l=n(1185);let c=()=>{let{t:e}=(0,o.Bd)("common"),t=(0,r.useRouter)(),[n,c]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),m=async()=>{let e=localStorage.getItem("vpn_user_token");if(!e){t.push("/login");return}h(!0);try{let n=l.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",s=await fetch("".concat(n,"/api/user/status"),{headers:{"x-access-token":e}});if(!s.ok){401===s.status&&(localStorage.removeItem("vpn_user_token"),t.push("/login"));let e=await s.json();throw Error(e.message||"Failed to fetch user data")}let a=await s.json();c(a),d(null)}catch(e){d(e.message||"An error occurred."),c(null)}finally{h(!1)}};(0,a.useEffect)(()=>{m();let e=new URLSearchParams(window.location.search);"true"===e.get("payment_success")&&(alert("Payment successful! Your VIP plan is now active or will be shortly after webhook processing."),t.replace("/dashboard",void 0),m()),"true"===e.get("payment_cancelled")&&(alert("Payment was cancelled. Your plan has not been changed."),t.replace("/dashboard",void 0))},[t]);let p=async()=>{let e=localStorage.getItem("vpn_user_token");if(!e){d("Authentication token not found. Please log in again."),t.push("/login");return}try{let t=l.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",n=await fetch("".concat(t,"/api/user/config"),{method:"GET",headers:{"x-access-token":e}});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to download configuration.")}let s=await n.blob(),a=window.URL.createObjectURL(s),o=document.createElement("a");o.href=a;let r=n.headers.get("content-disposition"),c="wg_config.conf";if(r&&-1!==r.indexOf("attachment")){let e=/filename[^;=\n]*=(([""])(.*?)\2|([^;\n]*))/.exec(r);null!=e&&e[3]?c=e[3]:null!=e&&e[4]&&(c=e[4])}o.download=c,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(a),d(null)}catch(e){d(e.message||"An error occurred while downloading the configuration.")}},g=async()=>{let e=localStorage.getItem("vpn_user_token");if(!e){t.push("/login");return}d(null);try{let t=l.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",n=await fetch("".concat(t,"/api/payment/create-checkout-session"),{method:"POST",headers:{"Content-Type":"application/json","x-access-token":e}}),s=await n.json();n.ok?s.checkout_url?window.location.href=s.checkout_url:d("Could not retrieve Stripe Checkout URL."):d(s.error||"Failed to create payment session.")}catch(e){d(e.message||"An error occurred during the upgrade process.")}};return u?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 text-center",children:"Loading dashboard..."}):i&&!n?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8 text-center text-red-500",children:["Error: ",i," ",(0,s.jsx)("button",{onClick:()=>t.push("/login"),className:"text-blue-500 underline ml-2",children:"Go to Login"})]}):n?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("header",{className:"mb-8",children:(0,s.jsx)("h1",{className:"text-3xl font-bold",children:e("nav_dashboard")})}),i&&(0,s.jsx)("p",{className:"text-red-500 text-center mb-4",children:i}),(0,s.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-lg mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Email:"})," ",n.email]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Current Plan:"})," ",n.plan]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Status:"})," ",(0,s.jsx)("span",{className:"font-semibold ".concat("Active"===n.status?"text-green-600":"text-red-600"),children:n.status})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Subscription Expires:"})," ",n.expires_at?new Date(n.expires_at).toLocaleDateString():n.is_vip?"N/A (VIP)":"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Bandwidth Used:"})," ",n.bandwidthUsed]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Bandwidth Limit:"})," ",n.bandwidthLimit]})]})]}),(0,s.jsxs)("section",{className:"bg-white p-6 rounded-lg shadow-lg",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Actions"}),(0,s.jsxs)("div",{className:"space-y-4 md:space-y-0 md:space-x-4 md:flex items-center",children:[(0,s.jsx)("button",{onClick:p,className:"w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg",children:"Download VPN Configuration"}),!n.is_vip&&(0,s.jsx)("button",{onClick:g,className:"w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg",children:"Upgrade to VIP"}),(0,s.jsx)("button",{onClick:()=>{localStorage.removeItem("vpn_user_token"),t.push("/login")},className:"w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg",children:"Logout"})]})]})]}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8 text-center",children:"No user data found. Please try logging in again."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[994,696,923,358],()=>t(108)),_N_E=e.O()}]);